name: Auto Reply to Discussions
on:
  discussion_comment:
    types: [created]

jobs:
  reply-bot:
    runs-on: ubuntu-latest
    steps:
      - name: Install GitHub CLI
        run: sudo apt-get install gh -y

      - name: Choose random response
        id: response
        run: |
          RESPONSES=(
            "Thanks for your input! ðŸ”’ We'll review and get back to you shortly. â€“ *Instance-security Bot*"
            "Appreciate you raising this! Your feedback helps keep our systems secure. ðŸ”"
            "Awesome! We're on it like a bot on a bug. ðŸ¤–"
            "Thanks for your contribution! Safety first, always. ðŸ›¡ï¸"
            "We're reviewing your note â€“ thanks for helping us stay secure! ðŸš¨"
          )
          RANDOM_INDEX=$((RANDOM % ${#RESPONSES[@]}))
          echo "response=${RESPONSES[$RANDOM_INDEX]}" >> $GITHUB_OUTPUT

      - name: Extract and debug discussion ID
        id: extract
        run: |
          echo "Extracting discussion ID..."
          echo "discussion_id=${{ github.event.discussion_comment.discussion_id }}" >> $GITHUB_OUTPUT
          echo "ðŸ“Œ Discussion ID: ${{ github.event.discussion_comment.discussion_id }}"

      - name: Post reply using GitHub CLI
        env:
          GH_TOKEN: ${{ secrets.BOT_TOKEN }}
        run: |
          echo "Posting to: repos/${{ github.repository }}/discussions/${{ steps.extract.outputs.discussion_id }}/comments"
          gh api repos/${{ github.repository }}/discussions/${{ steps.extract.outputs.discussion_id }}/comments \
            -f body="${{ steps.response.outputs.response }}"
